<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#04010f">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="mobile-web-app-capable" content="yes">
<title>StarsGuide</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Josefin+Sans:wght@100;300;400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --ink:#04010f;--deep:#080318;--mid:#110830;
  --gold:#c8a96e;--gold2:#e8d5a3;--dim:#6b5f4a;
  --text:#ede6d6;--soft:#b8ad9e;--accent:#7c4dce;
  --rose:#d4859a;--teal:#4db8c8;
}
html,body{width:100%;height:100%;overflow:hidden;background:var(--ink)}
body{font-family:'Cormorant Garamond',serif;color:var(--text);touch-action:manipulation}
#universe{position:fixed;inset:0;z-index:0}
.screen{position:fixed;inset:0;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .8s ease}
.screen.active{opacity:1;pointer-events:all}

/* SPLASH */
#splash{background:radial-gradient(ellipse at 50% 40%,#1a0a3a 0%,#04010f 70%)}
.splash-inner{text-align:center;padding:40px 30px}
.splash-sigil{width:120px;height:120px;margin:0 auto 32px;animation:sigilSpin 30s linear infinite,sigilGlow 4s ease-in-out infinite;filter:drop-shadow(0 0 30px rgba(200,169,110,.6))}
@keyframes sigilSpin{to{transform:rotate(360deg)}}
@keyframes sigilGlow{0%,100%{filter:drop-shadow(0 0 20px rgba(200,169,110,.4))}50%{filter:drop-shadow(0 0 50px rgba(200,169,110,.9)) drop-shadow(0 0 100px rgba(124,77,206,.4))}}
.app-name{font-family:'Josefin Sans',sans-serif;font-weight:100;font-size:clamp(2.8rem,10vw,5rem);letter-spacing:.4em;text-transform:uppercase;background:linear-gradient(135deg,#c8a96e,#ede6d6,#c8a96e);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:8px;animation:fadeUp .8s .3s both}
.app-tagline{font-size:1rem;letter-spacing:.25em;color:var(--dim);font-style:italic;margin-bottom:60px;animation:fadeUp .8s .5s both}
.btn-cosmic{display:inline-block;padding:18px 48px;border:1px solid rgba(200,169,110,.4);border-radius:2px;font-family:'Josefin Sans',sans-serif;font-weight:300;font-size:.8rem;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);background:rgba(200,169,110,.05);cursor:pointer;position:relative;overflow:hidden;transition:all .4s;animation:fadeUp .8s .7s both}
.btn-cosmic:active{background:rgba(200,169,110,.12);transform:scale(.98)}

/* ONBOARDING */
#onboarding{background:linear-gradient(180deg,#080318 0%,#04010f 100%);padding:0;justify-content:flex-start;overflow-y:auto}
.ob-scroll{width:100%;max-width:480px;padding:60px 28px;min-height:100%;display:flex;flex-direction:column;justify-content:center}
.ob-title{font-size:clamp(1.8rem,6vw,2.4rem);font-weight:300;color:var(--gold2);margin-bottom:6px;line-height:1.2}
.ob-sub{font-size:1rem;color:var(--dim);font-style:italic;margin-bottom:44px}
.field{margin-bottom:22px}
.field label{display:block;font-family:'Josefin Sans',sans-serif;font-size:.65rem;letter-spacing:.2em;text-transform:uppercase;color:var(--dim);margin-bottom:10px}
.field input,.field select{width:100%;background:transparent;border:none;border-bottom:1px solid rgba(200,169,110,.2);padding:12px 0;color:var(--text);font-family:'Cormorant Garamond',serif;font-size:1.2rem;outline:none;transition:border-color .3s;-webkit-appearance:none;border-radius:0}
.field input:focus,.field select:focus{border-bottom-color:var(--gold)}
.field input::placeholder{color:rgba(200,169,110,.25)}
.field select option{background:#110830;color:var(--text)}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.no-time{font-size:.85rem;color:var(--dim);font-style:italic;text-align:center;margin:4px 0 28px;cursor:pointer;text-decoration:underline}

/* MAIN APP */
#app{background:var(--ink);justify-content:flex-start;overflow:hidden}
.app-wrap{width:100%;height:100%;display:flex;flex-direction:column;overflow:hidden}
.top-bar{padding:16px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid rgba(200,169,110,.08);background:rgba(4,1,15,.9);backdrop-filter:blur(20px);flex-shrink:0;z-index:50}
.top-logo{font-family:'Josefin Sans',sans-serif;font-weight:100;font-size:.9rem;letter-spacing:.35em;color:var(--gold);text-transform:uppercase}
.top-user{font-size:1rem;color:var(--soft);font-style:italic}
.nav-bar{display:flex;background:rgba(8,3,24,.97);border-top:1px solid rgba(200,169,110,.08);flex-shrink:0}
.nav-item{flex:1;padding:13px 4px 11px;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;transition:all .3s;border-top:2px solid transparent}
.nav-item.active{border-top-color:var(--gold)}
.nav-icon{font-size:1.1rem;transition:transform .3s}
.nav-item.active .nav-icon{transform:scale(1.15)}
.nav-label{font-family:'Josefin Sans',sans-serif;font-size:.5rem;letter-spacing:.15em;text-transform:uppercase;color:var(--dim);transition:color .3s}
.nav-item.active .nav-label{color:var(--gold)}
.content-area{flex:1;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch}
.content-area::-webkit-scrollbar{display:none}
.page{display:none;min-height:100%;padding:20px 18px 40px;animation:pgIn .4s ease}
.page.active{display:block}
@keyframes pgIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* MANDALA */
.mandala-wrap{text-align:center;padding:6px 0 20px}
.mandala-hint{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.2em;color:var(--dim);text-transform:uppercase;margin-bottom:14px}
#mc{display:block;margin:0 auto;border-radius:50%;box-shadow:0 0 80px rgba(124,77,206,.3),0 0 160px rgba(200,169,110,.08);cursor:pointer}
.trio-cards{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:18px}
.trio-card{background:rgba(255,255,255,.03);border:1px solid rgba(200,169,110,.12);border-radius:12px;padding:14px 8px;text-align:center;transition:all .3s}
.trio-card:active{background:rgba(200,169,110,.06);transform:scale(.97)}
.trio-sym{font-size:1.6rem;margin-bottom:5px;display:block}
.trio-lbl{font-family:'Josefin Sans',sans-serif;font-size:.55rem;letter-spacing:.15em;color:var(--dim);text-transform:uppercase;display:block;margin-bottom:3px}
.trio-sign{font-size:.9rem;color:var(--gold2)}
.stell-banner{margin-top:14px;padding:18px;background:linear-gradient(135deg,rgba(124,77,206,.1),rgba(200,169,110,.08));border:1px solid rgba(200,169,110,.2);border-radius:14px;position:relative;overflow:hidden}
.stell-banner::after{content:'‚ú¶';position:absolute;right:-10px;top:-20px;font-size:80px;opacity:.04;color:var(--gold)}
.stell-title{font-family:'Josefin Sans',sans-serif;font-size:.65rem;letter-spacing:.2em;color:var(--gold);text-transform:uppercase;margin-bottom:8px}
.stell-text{font-size:.95rem;line-height:1.8;color:var(--soft)}

/* SECTION */
.sec-label{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.25em;color:var(--dim);text-transform:uppercase;margin:26px 0 13px;display:flex;align-items:center;gap:12px}
.sec-label::after{content:'';flex:1;height:1px;background:rgba(200,169,110,.12)}

/* PLANET CARD */
.p-card{background:rgba(255,255,255,.025);border:1px solid rgba(200,169,110,.1);border-radius:14px;padding:16px;margin-bottom:9px;display:flex;gap:13px;align-items:flex-start;transition:all .25s;cursor:pointer}
.p-card:active{background:rgba(200,169,110,.05);border-color:rgba(200,169,110,.3);transform:translateX(4px)}
.p-sym-box{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0}
.p-info{flex:1;min-width:0}
.p-name{font-size:1.05rem;color:var(--gold2);margin-bottom:2px;display:flex;align-items:center;gap:8px}
.p-pos{font-size:.8rem;color:var(--dim);font-style:italic;margin-bottom:5px}
.p-desc{font-size:.88rem;line-height:1.7;color:var(--soft)}
.retro-badge{font-family:'Josefin Sans',sans-serif;font-size:.5rem;letter-spacing:.1em;padding:2px 7px;background:rgba(212,133,154,.15);border:1px solid rgba(212,133,154,.3);color:var(--rose);border-radius:10px}

/* HOUSE */
.h-card{background:rgba(255,255,255,.025);border:1px solid rgba(124,77,206,.15);border-radius:14px;padding:16px;margin-bottom:9px}
.h-num{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.2em;color:var(--accent);text-transform:uppercase;margin-bottom:3px}
.h-sign{font-size:1.1rem;color:var(--gold);margin-bottom:5px}
.h-planets{font-size:.78rem;color:var(--gold);margin-bottom:5px;opacity:.7}
.h-desc{font-size:.88rem;line-height:1.7;color:var(--soft)}

/* ASPECT */
.asp-item{display:flex;align-items:center;gap:10px;padding:11px 13px;background:rgba(255,255,255,.02);border-radius:10px;margin-bottom:6px;border-left:2px solid}
.asp-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.asp-txt{flex:1;font-size:.83rem;color:var(--text)}
.asp-orb{font-size:.75rem;color:var(--dim)}
.asp-badge{font-family:'Josefin Sans',sans-serif;font-size:.5rem;letter-spacing:.08em;padding:2px 8px;border-radius:10px;border:1px solid;white-space:nowrap}

/* JOURNEY */
.step-card{background:rgba(255,255,255,.02);border:1px solid rgba(200,169,110,.1);border-radius:16px;padding:20px;margin-bottom:13px}
.step-num{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.2em;color:var(--gold);text-transform:uppercase;margin-bottom:9px}
.step-title{font-size:1.2rem;color:var(--gold2);margin-bottom:10px;font-weight:300}
.step-body{font-size:.93rem;line-height:1.88;color:var(--soft)}
.step-body strong{color:var(--gold2);font-weight:400}

/* SYNASTRY */
.syn-form{background:rgba(255,255,255,.02);border:1px solid rgba(200,169,110,.1);border-radius:16px;padding:20px;margin-bottom:22px}
.score-hero{text-align:center;padding:32px 20px;background:linear-gradient(135deg,rgba(124,77,206,.12),rgba(200,169,110,.08));border:1px solid rgba(200,169,110,.2);border-radius:18px;margin-bottom:18px}
.score-n{font-family:'Josefin Sans',sans-serif;font-weight:100;font-size:5rem;line-height:1;background:linear-gradient(135deg,#c8a96e,#ede6d6);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.score-pct{font-size:1.5rem;opacity:.6}
.score-lbl{font-size:.85rem;color:var(--dim);font-style:italic;margin-top:8px}
.score-msg{font-size:.93rem;line-height:1.7;color:var(--soft);margin-top:12px}
.bar-row{margin-bottom:13px}
.bar-lbl{display:flex;justify-content:space-between;font-size:.85rem;margin-bottom:5px}
.bar-lbl span:last-child{color:var(--gold);font-family:'Josefin Sans',sans-serif;font-size:.75rem}
.bar-track{height:4px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
.bar-fill{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--accent),var(--gold));transition:width 1.2s cubic-bezier(.4,0,.2,1)}

/* CHAT */
.chat-wrap{display:flex;flex-direction:column;height:calc(100svh - 170px);min-height:300px}
.chat-msgs{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:13px;padding:4px 0 14px}
.chat-msgs::-webkit-scrollbar{display:none}
.bubble{max-width:88%;padding:13px 17px;line-height:1.65;font-size:.93rem}
.bubble.ai{background:rgba(124,77,206,.12);border:1px solid rgba(124,77,206,.2);border-radius:16px 16px 16px 4px;align-self:flex-start}
.bubble.user{background:rgba(200,169,110,.1);border:1px solid rgba(200,169,110,.2);border-radius:16px 16px 4px 16px;align-self:flex-end}
.ai-label{font-family:'Josefin Sans',sans-serif;font-size:.55rem;letter-spacing:.15em;color:var(--accent);text-transform:uppercase;margin-bottom:5px;display:block}
.chips{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:12px}
.chip{padding:7px 13px;background:rgba(255,255,255,.03);border:1px solid rgba(200,169,110,.15);border-radius:20px;font-size:.78rem;color:var(--soft);cursor:pointer;transition:all .2s}
.chip:active{background:rgba(200,169,110,.1);border-color:var(--gold);color:var(--gold)}
.chat-row{display:flex;gap:10px;padding-top:13px;border-top:1px solid rgba(255,255,255,.06)}
.chat-in{flex:1;background:transparent;border:none;border-bottom:1px solid rgba(200,169,110,.2);padding:10px 0;color:var(--text);font-family:'Cormorant Garamond',serif;font-size:1.1rem;outline:none;transition:border-color .3s;border-radius:0}
.chat-in:focus{border-bottom-color:var(--gold)}
.chat-in::placeholder{color:rgba(200,169,110,.25)}
.send-btn{width:42px;height:42px;border-radius:50%;background:linear-gradient(135deg,#c8a96e,#9a7840);border:none;color:#04010f;font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.send-btn:active{transform:scale(.92)}

/* TRANSITS */
.daily-hero{background:linear-gradient(135deg,rgba(8,3,24,.9),rgba(4,1,15,.9));border:1px solid rgba(200,169,110,.15);border-radius:18px;padding:22px;margin-bottom:18px;text-align:center}
.daily-date{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.2em;color:var(--gold);text-transform:uppercase;margin-bottom:10px}
.daily-msg{font-size:1rem;line-height:1.85;font-style:italic;color:var(--soft)}
.t-card{background:rgba(255,255,255,.025);border:1px solid rgba(124,77,206,.12);border-radius:13px;padding:15px;margin-bottom:9px;display:flex;gap:13px}
.t-icon{font-size:1.5rem;flex-shrink:0;filter:drop-shadow(0 0 8px var(--gold))}
.t-title{font-size:.93rem;color:var(--gold);margin-bottom:3px}
.t-body{font-size:.83rem;line-height:1.65;color:var(--soft)}

/* MODAL */
.modal-bg{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.75);display:none;align-items:flex-end;justify-content:center;backdrop-filter:blur(4px)}
.modal-bg.open{display:flex}
.modal-box{width:100%;max-width:500px;background:linear-gradient(180deg,#1a0f35,#080318);border:1px solid rgba(200,169,110,.2);border-radius:22px 22px 0 0;padding:26px 22px 38px;max-height:75vh;overflow-y:auto;animation:modalUp .35s cubic-bezier(.4,0,.2,1)}
@keyframes modalUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.modal-handle{width:36px;height:3px;background:rgba(200,169,110,.3);border-radius:2px;margin:0 auto 18px}
.modal-title{font-size:1.3rem;color:var(--gold);margin-bottom:5px}
.modal-pos{font-size:.83rem;color:var(--dim);font-style:italic;margin-bottom:13px}
.modal-body{font-size:.93rem;line-height:1.85;color:var(--soft)}
.modal-body strong{color:var(--gold2);font-weight:400}
.divider{height:1px;background:rgba(200,169,110,.1);margin:14px 0}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.dots{display:inline-flex;gap:4px;align-items:center}
.dots span{width:5px;height:5px;background:var(--accent);border-radius:50%;animation:dotB 1.2s infinite}
.dots span:nth-child(2){animation-delay:.2s}.dots span:nth-child(3){animation-delay:.4s}
@keyframes dotB{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-5px)}}

/* ‚îÄ‚îÄ iOS SAFE AREA ‚îÄ‚îÄ */
.top-bar{padding-top:max(16px,env(safe-area-inset-top))!important}
.nav-bar{padding-bottom:env(safe-area-inset-bottom,0)}
.modal-box{padding-bottom:max(38px,env(safe-area-inset-bottom))}

/* ‚îÄ‚îÄ PREVENT iOS INPUT ZOOM ‚îÄ‚îÄ */
input,select,textarea{font-size:16px!important}

/* ‚îÄ‚îÄ SMALL PHONES <= 360px ‚îÄ‚îÄ */
@media(max-width:360px){
  .app-name{letter-spacing:.2em!important;font-size:2rem!important}
  .nav-label{font-size:.42rem!important}
  .nav-item{padding:10px 2px 8px!important}
  .trio-sign{font-size:.78rem!important}
  .page{padding:14px 14px 36px!important}
  .btn-cosmic{padding:14px 28px!important;letter-spacing:.2em!important}
  .ob-scroll{padding:40px 18px!important}
}

/* ‚îÄ‚îÄ MEDIUM PHONES 361-480px ‚îÄ‚îÄ */
@media(min-width:361px) and (max-width:480px){
  .nav-label{font-size:.46rem!important}
}

/* ‚îÄ‚îÄ LARGE PHONES & SMALL TABLETS 481-768px ‚îÄ‚îÄ */
@media(min-width:481px){
  .page{padding:22px 24px 44px!important}
  .top-bar{padding-left:28px!important;padding-right:28px!important}
  .nav-item{padding:13px 6px 11px!important}
  .nav-label{font-size:.54rem!important;letter-spacing:.14em!important}
  .nav-icon{font-size:1.15rem!important}
  .ob-scroll{padding:60px 40px!important}
  .mandala-wrap{padding:10px 0 24px!important}
}

/* ‚îÄ‚îÄ TABLET 769-1024px ‚îÄ‚îÄ */
@media(min-width:769px){
  body{display:flex;justify-content:center;align-items:stretch}
  #app,#splash,#onboarding{max-width:768px;left:50%;transform:translateX(-50%)}
  .page{max-width:720px;margin:0 auto;padding:28px 32px 52px!important}
  .nav-item{padding:14px 8px 12px!important}
  .nav-label{font-size:.6rem!important;letter-spacing:.18em!important}
  .nav-icon{font-size:1.2rem!important}
  .top-bar{padding:16px 32px!important}
  .modal-box{max-width:600px;border-radius:20px!important;margin-bottom:10vh}
  .modal-bg{align-items:center!important}
  .chat-wrap{height:calc(100svh - 140px)!important}
  .field-row{gap:24px!important}
  .score-n{font-size:5.5rem!important}
  .trio-cards{gap:16px!important}
  .trio-card{padding:18px 12px!important}
  .trio-sym{font-size:2rem!important}
  .step-title{font-size:1.3rem!important}
  .step-body{font-size:1rem!important}
  .h-desc,.p-desc,.t-body{font-size:.92rem!important}
}

/* ‚îÄ‚îÄ DESKTOP 1025px+ ‚îÄ‚îÄ */
@media(min-width:1025px){
  #app,#splash,#onboarding{max-width:900px}
  .page{max-width:860px!important;padding:32px 40px 60px!important}
  .top-logo{font-size:1rem!important;letter-spacing:.4em!important}
  .modal-box{max-width:660px!important}
  .chat-wrap{height:calc(100vh - 130px)!important}
  .p-card:hover{background:rgba(200,169,110,.05)!important;border-color:rgba(200,169,110,.3)!important;transform:translateX(4px)!important}
  .trio-card:hover{background:rgba(200,169,110,.06)!important;transform:scale(.98)!important}
  .chip:hover{background:rgba(200,169,110,.1)!important;border-color:var(--gold)!important;color:var(--gold)!important}
  .btn-cosmic:hover{background:rgba(200,169,110,.12)!important;border-color:rgba(200,169,110,.7)!important}
}

/* ‚îÄ‚îÄ LANDSCAPE MOBILE ‚îÄ‚îÄ */
@media(max-height:480px) and (orientation:landscape){
  .splash-sigil{width:70px!important;height:70px!important;margin-bottom:12px!important}
  .app-tagline{margin-bottom:20px!important}
  .ob-scroll{padding-top:20px!important;padding-bottom:20px!important;justify-content:flex-start!important}
  #mc{max-width:50vw!important;max-height:50vw!important;width:50vw!important;height:50vw!important}
  .nav-item{padding:8px 2px 6px!important}
  .nav-label{font-size:.4rem!important}
}

/* ‚îÄ‚îÄ HIGH DPI / RETINA ‚îÄ‚îÄ */
@media(-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){
  .btn-cosmic{border-width:.5px!important}
}

/* ‚îÄ‚îÄ DARK MODE (always) ‚îÄ‚îÄ */
@media(prefers-color-scheme:light){
  html{background:#04010f!important}
}

/* ‚îÄ‚îÄ MANDALA RESPONSIVE ‚îÄ‚îÄ */
#mc{max-width:min(340px, calc(100vw - 36px))!important}

</style>
</head>
<body>
<canvas id="universe"></canvas>

<!-- SPLASH -->
<div id="splash" class="screen active">
  <div class="splash-inner">
    <svg class="splash-sigil" viewBox="0 0 200 200" fill="none">
      <circle cx="100" cy="100" r="95" stroke="#c8a96e" stroke-width=".5" stroke-dasharray="4 6"/>
      <circle cx="100" cy="100" r="70" stroke="#c8a96e" stroke-width=".3" opacity=".5"/>
      <circle cx="100" cy="100" r="45" stroke="#c8a96e" stroke-width=".3" opacity=".3"/>
      <polygon points="100,10 118,65 175,65 129,100 147,155 100,120 53,155 71,100 25,65 82,65" fill="none" stroke="#c8a96e" stroke-width=".6" opacity=".6"/>
      <circle cx="100" cy="100" r="6" fill="#c8a96e" opacity=".8"/>
      <line x1="100" y1="5" x2="100" y2="195" stroke="#c8a96e" stroke-width=".2" opacity=".2"/>
      <line x1="5" y1="100" x2="195" y2="100" stroke="#c8a96e" stroke-width=".2" opacity=".2"/>
      <line x1="29" y1="29" x2="171" y2="171" stroke="#c8a96e" stroke-width=".2" opacity=".2"/>
      <line x1="171" y1="29" x2="29" y2="171" stroke="#c8a96e" stroke-width=".2" opacity=".2"/>
      <text x="100" y="104" text-anchor="middle" fill="#c8a96e" font-size="14" opacity=".9">‚ú¶</text>
    </svg>
    <div class="app-name">StarsGuide</div>
    <div class="app-tagline">o cosmos dentro de voc√™</div>
    <button class="btn-cosmic" onclick="goTo('onboarding')">Iniciar Jornada</button>
  </div>
</div>

<!-- ONBOARDING -->
<div id="onboarding" class="screen">
  <div class="ob-scroll">
    <div class="ob-title">Quem √© voc√™<br>para o universo?</div>
    <div class="ob-sub">Seus dados de nascimento revelam o mapa √∫nico da sua alma</div>
    <div class="field"><label>Seu Nome</label><input type="text" id="f-name" placeholder="Como voc√™ se chama?" autocomplete="given-name"/></div>
    <div class="field"><label>Data de Nascimento</label><input type="date" id="f-date"/></div>
    <div class="field-row">
      <div class="field"><label>Hora de Nascimento</label><input type="time" id="f-time"/></div>
      <div class="field"><label>Pa√≠s</label>
        <select id="f-country">
          <option value="-23.5">Brasil</option><option value="38.7">Portugal</option>
          <option value="40.4">Espanha</option><option value="48.8">Fran√ßa</option>
          <option value="51.5">Reino Unido</option><option value="40.7">EUA (NY)</option>
          <option value="19.4">M√©xico</option><option value="-34.6">Argentina</option><option value="-33.4">Chile</option>
        </select>
      </div>
    </div>
    <div class="no-time" onclick="document.getElementById('f-time').value=''">N√£o sei minha hora de nascimento</div>
    <button class="btn-cosmic" style="width:100%;text-align:center;display:block" onclick="buildChart()">‚ú¶ Revelar Meu Mapa</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="app" class="screen">
  <div class="app-wrap">
    <div class="top-bar">
      <div class="top-logo">‚ú¶ StarsGuide</div>
      <div class="top-user" id="top-name"></div>
    </div>
    <div class="content-area">
      <div class="page active" id="pg-mandala">
        <div class="mandala-wrap">
          <div class="mandala-hint">Toque nos planetas para interpretar</div>
          <canvas id="mc"></canvas>
          <div style="display:flex;gap:10px;justify-content:center;margin-top:14px">
            <button class="btn-cosmic" style="padding:10px 20px;font-size:.65rem" onclick="savePNG()">Salvar</button>
            <button class="btn-cosmic" style="padding:10px 20px;font-size:.65rem" onclick="shareMap()">Compartilhar</button>
          </div>
        </div>
        <div class="trio-cards" id="trio"></div>
        <div id="stell-zone"></div>
      </div>
      <div class="page" id="pg-chart"><div id="chart-out"></div></div>
      <div class="page" id="pg-journey"><div id="journey-out"></div></div>
      <div class="page" id="pg-syn"><div id="syn-out"></div></div>
      <div class="page" id="pg-chat">
        <div class="chat-wrap">
          <div class="chat-msgs" id="chat-msgs">
            <div class="bubble ai"><span class="ai-label">‚ú¶ Astr√≥logo IA</span><span id="welcome-msg"></span></div>
          </div>
          <div class="chips">
            <span class="chip" onclick="sendChip(this)">Qual √© minha miss√£o de vida?</span>
            <span class="chip" onclick="sendChip(this)">Por que tenho dificuldades em relacionamentos?</span>
            <span class="chip" onclick="sendChip(this)">Que carreira combina com meu mapa?</span>
            <span class="chip" onclick="sendChip(this)">O que meu Stellium revela?</span>
            <span class="chip" onclick="sendChip(this)">Qual √© minha ferida de Qu√≠ron?</span>
            <span class="chip" onclick="sendChip(this)">O que minha Casa 8 diz sobre mim?</span>
          </div>
          <div class="chat-row">
            <input class="chat-in" id="chat-in" placeholder="Pergunte ao seu mapa..." onkeydown="if(event.key==='Enter')sendMsg()"/>
            <button class="send-btn" onclick="sendMsg()">‚û§</button>
          </div>
        </div>
      </div>
      <div class="page" id="pg-transit"><div id="transit-out"></div></div>
      <div class="page" id="pg-extras"><div id="extras-out"></div></div>
    </div>
    <nav class="nav-bar">
      <div class="nav-item active" onclick="navTo('mandala',this)"><span class="nav-icon">üåå</span><span class="nav-label">Mandala</span></div>
      <div class="nav-item" onclick="navTo('chart',this)"><span class="nav-icon">ü™ê</span><span class="nav-label">Mapa</span></div>
      <div class="nav-item" onclick="navTo('journey',this)"><span class="nav-icon">‚ú®</span><span class="nav-label">Jornada</span></div>
      <div class="nav-item" onclick="navTo('syn',this)"><span class="nav-icon">üí´</span><span class="nav-label">Sinastria</span></div>
      <div class="nav-item" onclick="navTo('chat',this)"><span class="nav-icon">üîÆ</span><span class="nav-label">Chat IA</span></div>
      <div class="nav-item" onclick="navTo('transit',this)"><span class="nav-icon">üåô</span><span class="nav-label">Tr√¢nsitos</span></div>
      <div class="nav-item" onclick="navTo('extras',this)"><span class="nav-icon">‚ö°</span><span class="nav-label">Extras</span></div>
    </nav>
  </div>
</div>

<!-- MODAL -->
<div class="modal-bg" id="modal" onclick="closeModal(event)">
  <div class="modal-box">
    <div class="modal-handle"></div>
    <div class="modal-title" id="m-title"></div>
    <div class="modal-pos" id="m-pos"></div>
    <div class="modal-body" id="m-body"></div>
  </div>
</div>

<script>
// UNIVERSE BACKGROUND
(function(){
  const cv=document.getElementById('universe'),ctx=cv.getContext('2d');
  let W,H,stars=[],nebulas=[];
  function resize(){W=cv.width=innerWidth;H=cv.height=innerHeight}
  function init(){
    stars=[];nebulas=[];
    for(let i=0;i<300;i++)stars.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.2+.2,phase:Math.random()*Math.PI*2,speed:Math.random()*.004+.001});
    for(let i=0;i<5;i++)nebulas.push({x:Math.random()*W,y:Math.random()*H,r:Math.random()*200+100,hue:Math.random()>.5?260:200,a:Math.random()*.06+.02});
  }
  function draw(){
    ctx.clearRect(0,0,W,H);
    nebulas.forEach(n=>{const g=ctx.createRadialGradient(n.x,n.y,0,n.x,n.y,n.r);g.addColorStop(0,`hsla(${n.hue},70%,40%,${n.a})`);g.addColorStop(1,'transparent');ctx.fillStyle=g;ctx.beginPath();ctx.arc(n.x,n.y,n.r,0,Math.PI*2);ctx.fill()});
    stars.forEach(s=>{s.phase+=s.speed;const a=.2+.8*Math.abs(Math.sin(s.phase));ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fillStyle=`rgba(237,230,214,${a})`;ctx.fill()});
    requestAnimationFrame(draw);
  }
  resize();init();draw();
  window.addEventListener('resize',()=>{resize();init()});
})();

// ASTRONOMY
const RAD=Math.PI/180;
const n360=d=>((d%360)+360)%360;
function jd(y,mo,d,h){if(mo<=2){y--;mo+=12}const A=Math.floor(y/100),B=2-A+Math.floor(A/4);return Math.floor(365.25*(y+4716))+Math.floor(30.6001*(mo+1))+d+h/24+B-1524.5}
function T(j){return(j-2451545)/36525}
function sunLon(j){const t=T(j),L0=n360(280.46646+36000.76983*t),M=n360(357.52911+35999.05029*t),Mr=M*RAD;return n360(L0+(1.914602-.004817*t)*Math.sin(Mr)+.019993*Math.sin(2*Mr)+.000289*Math.sin(3*Mr))}
function moonLon(j){const t=T(j),Lp=n360(218.3164477+481267.88123421*t),D=n360(297.8501921+445267.1114034*t),M=n360(357.5291092+35999.0502909*t),Mp=n360(134.9633964+477198.8675055*t),F=n360(93.272+483202.0175233*t);return n360(Lp+6.288774*Math.sin(Mp*RAD)+1.274027*Math.sin((2*D-Mp)*RAD)+.658314*Math.sin(2*D*RAD)+.213618*Math.sin(2*Mp*RAD)-.185116*Math.sin(M*RAD)-.114332*Math.sin(2*F*RAD)+.058793*Math.sin((2*D-2*Mp)*RAD)+.057066*Math.sin((2*D-M-Mp)*RAD)+.053322*Math.sin((2*D+Mp)*RAD))}
function mercLon(j){const t=T(j),L=n360(252.250906+149474.0722491*t),M=n360(174.7948+4.09233445*(j-2451545));return n360(L+23.44*Math.sin(M*RAD)+2.9818*Math.sin(2*M*RAD))}
function venLon(j){const t=T(j),L=n360(181.979801+58519.2130302*t),M=n360(212.26+1.60213*(j-2451545));return n360(L+.7758*Math.sin(M*RAD))}
function marLon(j){const t=T(j),L=n360(355.433275+19141.6964746*t),M=n360(19.373+.52402612*(j-2451545));return n360(L+10.6912*Math.sin(M*RAD)+.6228*Math.sin(2*M*RAD))}
function jupLon(j){const t=T(j),L=n360(34.351519+3036.3027748*t),M=n360(20.9+.08309*(j-2451545));return n360(L+5.5549*Math.sin(M*RAD)+.1683*Math.sin(2*M*RAD))}
function satLon(j){const t=T(j),L=n360(50.077444+1223.5110686*t),M=n360(317.9+.03344*(j-2451545));return n360(L+6.3585*Math.sin(M*RAD)+.2204*Math.sin(2*M*RAD))}
function uraLon(j){const t=T(j);return n360(314.055005+429.8640561*t)}
function nepLon(j){const t=T(j);return n360(304.348665+219.8833092*t)}
function pluLon(j){const t=T(j);return n360(238.92881+145.2078*t)}
function nodLon(j){const t=T(j);return n360(125.04452-1934.136261*t)}
function chiLon(j){const t=T(j);return n360(209.0+50.73*t)}
function ascLon(j,h,lat){const t=T(j),theta=n360(100.4606184+36000.7700536*t+h*15),eps=23.4392911-.013004167*t,a=Math.atan2(Math.cos(theta*RAD),-(Math.sin(theta*RAD)*Math.cos(eps*RAD)+Math.tan(lat*RAD)*Math.sin(eps*RAD)));return n360(a*180/Math.PI)}
function isRetro(fn,j){try{return fn(j+5)<fn(j-5)}catch(e){return false}}
function mkP(lon){return{deg:Math.floor(lon),min:Math.floor((lon%1)*60),sign:Math.floor(lon/30),lon}}

const SIGNS=['√Åries','Touro','G√™meos','C√¢ncer','Le√£o','Virgem','Libra','Escorpi√£o','Sagit√°rio','Capric√≥rnio','Aqu√°rio','Peixes'];
const SSYM=['‚ôà','‚ôâ','‚ôä','‚ôã','‚ôå','‚ôç','‚ôé','‚ôè','‚ôê','‚ôë','‚ôí','‚ôì'];
const SCOL=['#c8a96e','#b89d62','#c8a96e','#a08050','#c8a96e','#b89d62','#c8a96e','#a08050','#c8a96e','#b89d62','#c8a96e','#a08050'];
const PL=[{n:'Sol',s:'‚òâ',c:'#e8d5a3'},{n:'Lua',s:'‚òΩ',c:'#d0cfc8'},{n:'Merc√∫rio',s:'‚òø',c:'#b8b8cc'},{n:'V√™nus',s:'‚ôÄ',c:'#d4a0aa'},{n:'Marte',s:'‚ôÇ',c:'#c87060'},{n:'J√∫piter',s:'‚ôÉ',c:'#c8a96e'},{n:'Saturno',s:'‚ôÑ',c:'#a89060'},{n:'Urano',s:'‚õ¢',c:'#80b0b8'},{n:'Netuno',s:'‚ôÜ',c:'#7080b0'},{n:'Plut√£o',s:'‚ôá',c:'#9070a0'},{n:'Nodo Norte',s:'‚òä',c:'#c8a96e'},{n:'Qu√≠ron',s:'‚ö∑',c:'#90a890'}];
const PMEAN={'Sol':'Sua ess√™ncia central, vitalidade e prop√≥sito da encarna√ß√£o. Como voc√™ brilha no mundo.','Lua':'Mundo emocional, instintos e inconsciente. Como voc√™ sente quando √© verdadeiramente voc√™.','Merc√∫rio':'Mente, comunica√ß√£o e como voc√™ processa e transmite informa√ß√µes.','V√™nus':'Amor, beleza, prazer e o que voc√™ deseja e atrai nos relacionamentos.','Marte':'Energia vital, desejo, coragem e como voc√™ age para conquistar o que quer.','J√∫piter':'Expans√£o, abund√¢ncia e as √°reas onde a vida te presenteia com crescimento.','Saturno':'Responsabilidade, karma e as li√ß√µes mais profundas que voc√™ veio aprender.','Urano':'Revolu√ß√£o, originalidade e as mudan√ßas que te libertam do passado.','Netuno':'Espiritualidade, sonhos e a dissolu√ß√£o dos limites entre o eu e o todo.','Plut√£o':'Transforma√ß√£o profunda, poder e os ciclos inevit√°veis de morte e renascimento da alma.','Nodo Norte':'Miss√£o de vida k√°rmica ‚Äî o caminho que sua alma escolheu para essa encarna√ß√£o.','Qu√≠ron':'A ferida ancestral que quando curada se torna seu maior dom e capacidade de cura.'};
const HMEAN=['Identidade, apar√™ncia e como o mundo te percebe √† primeira vista.','Dinheiro, valores pessoais e o que voc√™ considera verdadeiramente precioso.','Comunica√ß√£o, mente, aprendizado e rela√ß√µes com irm√£os e vizinhan√ßa.','Lar, fam√≠lia, ra√≠zes e a base emocional que te sustenta.','Criatividade, prazer, romance, filhos e autoexpress√£o aut√™ntica.','Sa√∫de, rotina, trabalho e os h√°bitos que moldam sua vida cotidiana.','Relacionamentos s√©rios, parcerias, casamento e contratos.','Transforma√ß√£o, sexo, morte, heran√ßas, poder e o ocultismo.','Filosofia, viagens longas, espiritualidade e expans√£o de consci√™ncia.','Carreira, status p√∫blico, reputa√ß√£o e o legado que voc√™ deixa.','Amizades, grupos, sonhos coletivos e os ideais que voc√™ carrega.','Inconsciente, karma, isolamento e a espiritualidade mais profunda da alma.'];
const ASPS=[{n:'Conjun√ß√£o',a:0,o:8,c:'#e8d5a3',h:'neutro'},{n:'Sextil',a:60,o:6,c:'#a0b8a0',h:'harmonioso'},{n:'Quadratura',a:90,o:8,c:'#b07070',h:'tenso'},{n:'Tr√≠gono',a:120,o:8,c:'#7090b0',h:'harmonioso'},{n:'Oposi√ß√£o',a:180,o:8,c:'#b08050',h:'tenso'},{n:'Quinc√∫ncio',a:150,o:3,c:'#9070a0',h:'tenso'}];

let C={},userData={},syn={};

function buildChart(){
  const name=document.getElementById('f-name').value.trim();
  const date=document.getElementById('f-date').value;
  const time=document.getElementById('f-time').value;
  const lat=parseFloat(document.getElementById('f-country').value);
  if(!name||!date){alert('Preencha nome e data.');return}
  userData={name,date,time,lat};
  C=calcChart(date,time,lat,name);
  document.getElementById('top-name').textContent=name;
  document.getElementById('welcome-msg').textContent=`${name}, seu mapa est√° revelado. Sol em ${SIGNS[C.sun.sign]}, Lua em ${SIGNS[C.moon.sign]} e Ascendente em ${SIGNS[C.asc.sign]}. O universo tem muito a dizer sobre voc√™. O que voc√™ quer descobrir hoje?`;
  goTo('app');renderMandala();renderTrio();renderChart();renderJourney();renderSynForm();renderTransits();
}

function calcChart(date,time,lat,name){
  const d=new Date(date+(time?'T'+time:'T12:00'));
  const J=jd(d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours()+d.getMinutes()/60);
  const fns=[sunLon,moonLon,mercLon,venLon,marLon,jupLon,satLon,uraLon,nepLon,pluLon,nodLon,chiLon];
  const planets=fns.map(f=>mkP(f(J)));
  const retro=fns.map((f,i)=>i>=2?isRetro(f,J):false);
  const ascDeg=time?ascLon(J,d.getHours()+d.getMinutes()/60,lat):planets[0].lon;
  const asc=mkP(ascDeg);
  const houses=Array.from({length:12},(_,i)=>{const c=n360(ascDeg+i*30);return{num:i+1,cusp:c,sign:Math.floor(c/30),planets:[]}});
  planets.forEach((p,i)=>{const hi=Math.floor(n360(p.lon-ascDeg)/30);if(houses[hi])houses[hi].planets.push(i)});
  const aspects=[];
  for(let i=0;i<planets.length-1;i++)for(let j=i+1;j<planets.length;j++){let d=Math.abs(planets[i].lon-planets[j].lon);if(d>180)d=360-d;ASPS.forEach(a=>{const o=Math.abs(d-a.a);if(o<=a.o)aspects.push({p1:i,p2:j,type:a.n,orb:o.toFixed(1),c:a.c,h:a.h})})}
  const stelliums=[];
  houses.forEach(h=>{if(h.planets.length>=3)stelliums.push({house:h.num,sign:h.sign,planets:h.planets})});
  SIGNS.forEach((_,i)=>{const pp=planets.map((p,j)=>({p,j})).filter(({p})=>p.sign===i).map(({j})=>j);if(pp.length>=3&&!stelliums.find(s=>s.sign===i&&!s.house))stelliums.push({sign:i,planets:pp})});
  return{name,asc,planets,houses,aspects,stelliums,retro,sun:planets[0],moon:planets[1],mercury:planets[2],venus:planets[3],mars:planets[4],jupiter:planets[5],saturn:planets[6],uranus:planets[7],neptune:planets[8],pluto:planets[9],northNode:planets[10],chiron:planets[11]};
}

// MANDALA
function renderMandala(){
  const cv=document.getElementById('mc');
  const sz=Math.min(window.innerWidth-36,340,window.innerHeight*.6|0);
  cv.width=cv.height=sz;
  const ctx=cv.getContext('2d'),cx=sz/2,cy=sz/2;
  const R=sz*.48,signR=sz*.41,houseR=sz*.31,pR=sz*.36,iR=sz*.1;
  ctx.clearRect(0,0,sz,sz);
  const bg=ctx.createRadialGradient(cx,cy,0,cx,cy,R);
  bg.addColorStop(0,'rgba(17,8,48,.95)');bg.addColorStop(.6,'rgba(8,3,24,.98)');bg.addColorStop(1,'rgba(4,1,15,1)');
  ctx.beginPath();ctx.arc(cx,cy,R,0,Math.PI*2);ctx.fillStyle=bg;ctx.fill();
  ctx.beginPath();ctx.arc(cx,cy,R,0,Math.PI*2);ctx.strokeStyle='rgba(200,169,110,.5)';ctx.lineWidth=1.5;ctx.stroke();
  for(let i=0;i<12;i++){
    const a1=(i*30-90)*RAD,a2=((i+1)*30-90)*RAD,am=((i*30+15)-90)*RAD;
    ctx.beginPath();ctx.moveTo(cx,cy);ctx.arc(cx,cy,R,a1,a2);ctx.closePath();ctx.fillStyle=`rgba(200,169,110,0.02)`;ctx.fill();
    ctx.beginPath();ctx.moveTo(cx+signR*Math.cos(a1),cy+signR*Math.sin(a1));ctx.lineTo(cx+R*Math.cos(a1),cy+R*Math.sin(a1));ctx.strokeStyle='rgba(200,169,110,.25)';ctx.lineWidth=.8;ctx.stroke();
    const sR=(signR+R)/2;ctx.font=`${sz*.052}px serif`;ctx.fillStyle=SCOL[i];ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(SSYM[i],cx+sR*Math.cos(am),cy+sR*Math.sin(am));
  }
  ctx.beginPath();ctx.arc(cx,cy,signR,0,Math.PI*2);ctx.strokeStyle='rgba(200,169,110,.3)';ctx.lineWidth=1;ctx.stroke();
  const ascDeg=C.asc.lon;
  for(let i=0;i<12;i++){
    const angle=((i*30-ascDeg-90+360)%360)*RAD;
    ctx.beginPath();ctx.moveTo(cx+iR*Math.cos(angle),cy+iR*Math.sin(angle));ctx.lineTo(cx+houseR*Math.cos(angle),cy+houseR*Math.sin(angle));ctx.strokeStyle='rgba(124,77,206,.35)';ctx.lineWidth=.8;ctx.stroke();
    const midA=(((i*30+15)-ascDeg-90+360)%360)*RAD,nR=(iR+houseR)/2;
    ctx.font=`${sz*.032}px 'Josefin Sans',sans-serif`;ctx.fillStyle='rgba(124,77,206,.7)';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(i+1,cx+nR*Math.cos(midA),cy+nR*Math.sin(midA));
  }
  ctx.beginPath();ctx.arc(cx,cy,houseR,0,Math.PI*2);ctx.strokeStyle='rgba(124,77,206,.3)';ctx.lineWidth=1;ctx.stroke();
  ctx.beginPath();ctx.arc(cx,cy,iR,0,Math.PI*2);ctx.strokeStyle='rgba(200,169,110,.2)';ctx.lineWidth=1;ctx.stroke();
  C.aspects.slice(0,25).forEach(asp=>{
    const p1=C.planets[asp.p1],p2=C.planets[asp.p2];
    const a1=(p1.lon-90)*RAD,a2=(p2.lon-90)*RAD;
    ctx.beginPath();ctx.moveTo(cx+pR*.9*Math.cos(a1),cy+pR*.9*Math.sin(a1));ctx.lineTo(cx+pR*.9*Math.cos(a2),cy+pR*.9*Math.sin(a2));ctx.strokeStyle=asp.c+'44';ctx.lineWidth=.7;ctx.stroke();
  });
  const aa=(ascDeg-90)*RAD;
  ctx.beginPath();ctx.moveTo(cx+iR*Math.cos(aa),cy+iR*Math.sin(aa));ctx.lineTo(cx+houseR*Math.cos(aa),cy+houseR*Math.sin(aa));ctx.strokeStyle='rgba(200,169,110,.9)';ctx.lineWidth=2;ctx.stroke();
  C.planets.forEach((p,i)=>{
    if(i>=PL.length)return;
    const angle=(p.lon-90)*RAD,px=cx+pR*Math.cos(angle),py=cy+pR*Math.sin(angle);
    const g=ctx.createRadialGradient(px,py,0,px,py,sz*.06);g.addColorStop(0,PL[i].c+'66');g.addColorStop(1,'transparent');ctx.beginPath();ctx.arc(px,py,sz*.06,0,Math.PI*2);ctx.fillStyle=g;ctx.fill();
    ctx.font=`bold ${sz*.048}px serif`;ctx.fillStyle=PL[i].c;ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText(PL[i].s,px,py);
    if(C.retro[i]){ctx.beginPath();ctx.arc(px+sz*.022,py-sz*.022,sz*.012,0,Math.PI*2);ctx.fillStyle='#d4859a';ctx.fill()}
  });
  ctx.font=`${sz*.05}px serif`;ctx.fillStyle='rgba(200,169,110,.5)';ctx.textAlign='center';ctx.textBaseline='middle';ctx.fillText('‚ú¶',cx,cy);
  cv.onclick=e=>{const rect=cv.getBoundingClientRect(),mx=e.clientX-rect.left,my=e.clientY-rect.top;C.planets.forEach((p,i)=>{if(i>=PL.length)return;const angle=(p.lon-90)*RAD,px=cx+pR*Math.cos(angle),py2=cy+pR*Math.sin(angle);if(Math.hypot(mx-px,my-py2)<sz*.07)showModal(i,p)})};
}

function renderTrio(){
  document.getElementById('trio').innerHTML=['sun','moon','asc'].map((k,i)=>{const p=C[k],labels=['Sol','Lua','Ascendente'],syms=[PL[0].s,PL[1].s,'AC'],cols=['#FFD700','#C8C8D0','#7c4dce'];return`<div class="trio-card"><span class="trio-sym" style="filter:drop-shadow(0 0 8px ${cols[i]})">${syms[i]}</span><span class="trio-lbl">${labels[i]}</span><span class="trio-sign">${SIGNS[p.sign]}</span></div>`}).join('');
  let stell='';
  if(C.stelliums.length>0){const s=C.stelliums[0],pnames=s.planets.map(i=>PL[i]?.n).filter(Boolean).join(', ');stell=`<div class="stell-banner"><div class="stell-title">‚ú¶ Stellium Detectado</div><div class="stell-text">${C.name}, voc√™ tem ${s.planets.length} planetas concentrados em ${s.house?'sua Casa '+s.house:SIGNS[s.sign]}: ${pnames}. Esta concentra√ß√£o define o tema central da sua jornada nessa encarna√ß√£o ‚Äî uma intensidade rara e transformadora.</div></div>`}
  document.getElementById('stell-zone').innerHTML=stell;
}

function renderChart(){
  let h='';
  h+=`<div class="sec-label">Planetas</div>`;
  C.planets.forEach((p,i)=>{if(i>=PL.length)return;const pl=PL[i],hN=Math.floor(n360(p.lon-C.asc.lon)/30)+1;h+=`<div class="p-card" onclick="showModal(${i},C.planets[${i}])"><div class="p-sym-box" style="background:${pl.c}18;border:1px solid ${pl.c}33"><span style="color:${pl.c};font-size:1.3rem">${pl.s}</span></div><div class="p-info"><div class="p-name">${pl.n}${C.retro[i]?'<span class="retro-badge">‚Ñû</span>':''}</div><div class="p-pos">${p.deg}¬∞${p.min}' ${SIGNS[p.sign]} ¬∑ Casa ${hN}</div><div class="p-desc">${PMEAN[pl.n].substring(0,90)}‚Ä¶</div></div></div>`});
  h+=`<div class="sec-label">Casas Astrais</div>`;
  C.houses.forEach(ho=>{const pln=ho.planets.map(i=>PL[i]?.s+' '+PL[i]?.n).filter(Boolean).join(', ');h+=`<div class="h-card"><div class="h-num">Casa ${ho.num}</div><div class="h-sign">${SSYM[ho.sign]} ${SIGNS[ho.sign]}</div>${pln?`<div class="h-planets">${pln}</div>`:''}<div class="h-desc">${HMEAN[ho.num-1]}</div></div>`});
  h+=`<div class="sec-label">Aspectos</div>`;
  C.aspects.slice(0,18).forEach(a=>{const p1=PL[a.p1],p2=PL[a.p2];if(!p1||!p2)return;const bc=a.h==='harmonioso'?'rgba(0,255,100,.1)':a.h==='tenso'?'rgba(255,80,0,.1)':'rgba(200,169,110,.1)',cc=a.h==='harmonioso'?'rgba(0,255,100,.4)':a.h==='tenso'?'rgba(255,80,0,.4)':'rgba(200,169,110,.4)',tc=a.h==='harmonioso'?'#00cc66':a.h==='tenso'?'#ff5522':'#c8a96e';h+=`<div class="asp-item" style="border-left-color:${a.c}"><div class="asp-dot" style="background:${a.c}"></div><div class="asp-txt">${p1.s} ${p1.n} <span style="color:var(--dim)">${a.type}</span> ${p2.s} ${p2.n}</div><div class="asp-orb">${a.orb}¬∞</div><span class="asp-badge" style="background:${bc};border-color:${cc};color:${tc}">${a.h}</span></div>`});
  if(C.stelliums.length>0){h+=`<div class="sec-label">Stelliums</div>`;C.stelliums.forEach(s=>{const pnames=s.planets.map(i=>PL[i]?.n).filter(Boolean).join(', ');h+=`<div class="stell-banner"><div class="stell-title">‚ú¶ ${s.house?'Casa '+s.house:SIGNS[s.sign]}</div><div style="font-size:.78rem;color:var(--gold);margin-bottom:6px">${pnames}</div><div class="stell-text">Esta concentra√ß√£o domina ${s.house?HMEAN[s.house-1].toLowerCase().split(',')[0]:'os temas de '+SIGNS[s.sign]}, tornando esses temas centrais na sua vida.</div></div>`})}
  document.getElementById('chart-out').innerHTML=h;
}

function renderJourney(){
  const steps=[
    {n:'Passo 1 ‚Äî Sua Ess√™ncia',t:'Quem voc√™ √© no cosmos',b:`${C.name}, voc√™ √© um ser com Sol em <strong>${SIGNS[C.sun.sign]}</strong>, Lua em <strong>${SIGNS[C.moon.sign]}</strong> e Ascendente em <strong>${SIGNS[C.asc.sign]}</strong>.<br><br>Seu Sol em ${SIGNS[C.sun.sign]} √© sua chama vital ‚Äî o prop√≥sito que veio expressar. Sua Lua em ${SIGNS[C.moon.sign]} √© seu mundo interno, como sente e processa a vida em sil√™ncio. O Ascendente em ${SIGNS[C.asc.sign]} √© como o mundo te encontra antes de te conhecer.`},
    {n:'Passo 2 ‚Äî Mente, Amor e A√ß√£o',t:'Seus planetas pessoais',b:`Sua mente opera atrav√©s de <strong>Merc√∫rio em ${SIGNS[C.mercury.sign]}</strong> ‚Äî voc√™ pensa e fala com as qualidades √∫nicas desse signo.<br><br><strong>V√™nus em ${SIGNS[C.venus.sign]}</strong> revela o que seu cora√ß√£o busca e atrai. √â sua forma de amar e de se relacionar.<br><br><strong>Marte em ${SIGNS[C.mars.sign]}</strong> √© sua for√ßa de a√ß√£o e coragem ‚Äî como voc√™ vai atr√°s do que quer com a intensidade de ${SIGNS[C.mars.sign]}.`},
    {n:'Passo 3 ‚Äî Suas Casas Mais Ativas',t:'Onde a energia se concentra',b:(()=>{const ac=C.houses.filter(h=>h.planets.length>0).sort((a,b)=>b.planets.length-a.planets.length).slice(0,3);return ac.map(h=>`<strong>Casa ${h.num}</strong> em ${SIGNS[h.sign]}: ${HMEAN[h.num-1]}`).join('<br><br>')||'Seu mapa possui distribui√ß√£o equilibrada de energia ‚Äî uma personalidade multifacetada e adapt√°vel.'})()},
    {n:'Passo 4 ‚Äî Destino K√°rmico',t:'Nodo Norte e Qu√≠ron',b:`Seu <strong>Nodo Norte em ${SIGNS[C.northNode.sign]}</strong> revela a miss√£o que sua alma escolheu para essa encarna√ß√£o. √â o ponto de crescimento ‚Äî o caminho √†s vezes dif√≠cil, mas profundamente recompensador.<br><br>Seu <strong>Qu√≠ron em ${SIGNS[C.chiron.sign]}</strong> marca a ferida que carrega desde vidas passadas. Quando aprende a trabalhar com essa dor, ela se transforma no seu maior dom ‚Äî sua capacidade de curar os outros.`},
    {n:'Passo 5 ‚Äî Sua Integra√ß√£o',t:'O padr√£o completo',b:(()=>{const harm=C.aspects.filter(a=>a.h==='harmonioso').length,tens=C.aspects.filter(a=>a.h==='tenso').length;return`${C.name}, seu mapa possui <strong>${harm} aspectos harm√¥nicos</strong> e <strong>${tens} aspectos de tens√£o</strong>.<br><br>Os harm√¥nicos s√£o seus dons naturais. Os tensos s√£o seus maiores mestres ‚Äî os pontos que mais desafiam e que, quando integrados, tornam-se sua for√ßa mais profunda.<br><br>Voc√™ n√£o √© apenas planetas e casas. Voc√™ √© o padr√£o √∫nico que esses elementos formam juntos ‚Äî e esse padr√£o √© absolutamente singular no universo.`})()}
  ];
  document.getElementById('journey-out').innerHTML=steps.map(s=>`<div class="step-card"><div class="step-num">${s.n}</div><div class="step-title">${s.t}</div><div class="step-body">${s.b}</div></div>`).join('');
}

function renderSynForm(){
  document.getElementById('syn-out').innerHTML=`
    <div class="sec-label" style="margin-top:0">Sinastria</div>
    <p style="font-size:.9rem;color:var(--dim);font-style:italic;margin-bottom:18px">Compare dois mapas e descubra a profundidade dessa conex√£o</p>
    <div class="syn-form">
      <div class="field"><label>Nome</label><input type="text" id="sn" placeholder="Nome da outra pessoa"/></div>
      <div class="field"><label>Data de Nascimento</label><input type="date" id="sd"/></div>
      <div class="field-row">
        <div class="field"><label>Hora</label><input type="time" id="st"/></div>
        <div class="field"><label>Pa√≠s</label><select id="slat"><option value="-23.5">Brasil</option><option value="38.7">Portugal</option><option value="40.4">Espanha</option><option value="40.7">EUA</option><option value="-34.6">Argentina</option></select></div>
      </div>
      <button class="btn-cosmic" style="width:100%;text-align:center;display:block;margin-top:18px" onclick="calcSyn()">‚ú¶ Analisar Conex√£o</button>
    </div>
    <div id="syn-result"></div>`;
}

function calcSyn(){
  const name=document.getElementById('sn').value.trim(),date=document.getElementById('sd').value,time=document.getElementById('st').value,lat=parseFloat(document.getElementById('slat').value);
  if(!name||!date){alert('Preencha nome e data.');return}
  syn=calcChart(date,time,lat,name);
  const c1=C,c2=syn,cross=[];
  c1.planets.forEach((p1,i)=>c2.planets.forEach((p2,j)=>{if(i>=PL.length||j>=PL.length)return;let d=Math.abs(p1.lon-p2.lon);if(d>180)d=360-d;ASPS.forEach(a=>{const o=Math.abs(d-a.a);if(o<=a.o)cross.push({p1:i,p2:j,type:a.n,orb:o.toFixed(1),c:a.c,h:a.h})})}));
  const sc=Math.min(98,Math.max(35,cross.filter(a=>a.h==='harmonioso').length*8+cross.filter(a=>a.h==='neutro').length*5+40-cross.filter(a=>a.h==='tenso').length*2));
  const areas=[{l:'Amor e atra√ß√£o f√≠sica',v:Math.min(99,sc+Math.floor(Math.random()*14)-6)},{l:'Comunica√ß√£o e entendimento',v:Math.min(99,sc+Math.floor(Math.random()*14)-6)},{l:'Valores e projetos de vida',v:Math.min(99,sc+Math.floor(Math.random()*14)-6)},{l:'Karma e conex√£o de alma',v:Math.min(99,sc+Math.floor(Math.random()*18)-4)},{l:'Desafios e crescimento m√∫tuo',v:Math.min(99,sc+Math.floor(Math.random()*14)-6)}];
  document.getElementById('syn-result').innerHTML=`
    <div class="score-hero"><div class="score-n">${sc}<span class="score-pct">%</span></div><div class="score-lbl">${c1.name} & ${c2.name}</div><div class="score-msg">${sc>75?'Uma conex√£o de almas rara e profunda. Seus mapas se complementam de forma extraordin√°ria.':sc>55?'Uma rela√ß√£o com imenso potencial de crescimento e transforma√ß√£o m√∫tua.':'Uma conex√£o de intensos aprendizados. Os desafios existem para despertar o melhor em ambos.'}</div></div>
    <div class="sec-label">Compatibilidade por √Årea</div>
    ${areas.map(a=>`<div class="bar-row"><div class="bar-lbl"><span>${a.l}</span><span>${a.v}%</span></div><div class="bar-track"><div class="bar-fill" style="width:${a.v}%"></div></div></div>`).join('')}
    <div class="sec-label">Aspectos entre os Mapas</div>
    ${cross.slice(0,12).map(a=>{const p1=PL[a.p1],p2=PL[a.p2];if(!p1||!p2)return'';const tc=a.h==='harmonioso'?'#00cc66':a.h==='tenso'?'#ff5522':'#c8a96e';return`<div class="asp-item" style="border-left-color:${a.c}"><div class="asp-dot" style="background:${a.c}"></div><div class="asp-txt" style="font-size:.8rem"><span style="color:#c8a96e">${p1.s} ${c1.name}</span> ${a.type} <span style="color:#7c4dce">${p2.s} ${c2.name}</span></div><span class="asp-badge" style="color:${tc};border-color:${tc}44">${a.orb}¬∞</span></div>`}).join('')}
    <div class="sec-label">Interpreta√ß√£o Final</div>
    <div class="step-card"><div class="step-body">A conex√£o entre <strong>${c1.name}</strong> e <strong>${c2.name}</strong> traz o encontro de ${SIGNS[c1.sun.sign]} com ${SIGNS[c2.sun.sign]}. Essa rela√ß√£o chegou para ensinar ${c1.name} sobre ${HMEAN[c2.asc.sign%12].toLowerCase().split(',')[0]}, enquanto ${c2.name} aprende com ${c1.name} sobre ${HMEAN[c1.asc.sign%12].toLowerCase().split(',')[0]}. Os pontos de tens√£o s√£o exatamente onde maior transforma√ß√£o acontece para ambos.</div></div>`;
}

async function sendMsg(){const inp=document.getElementById('chat-in'),msg=inp.value.trim();if(!msg)return;inp.value='';addBubble(msg,'user');await aiReply(msg)}
function sendChip(el){document.getElementById('chat-in').value=el.textContent;sendMsg()}
function addBubble(txt,type){const d=document.createElement('div');d.className=`bubble ${type}`;if(type==='ai')d.innerHTML=`<span class="ai-label">‚ú¶ Astr√≥logo IA</span>${txt}`;else d.textContent=txt;const m=document.getElementById('chat-msgs');m.appendChild(d);m.scrollTop=99999;return d}
async function aiReply(msg){
  const el=addBubble('<div class="dots"><span></span><span></span><span></span></div>','ai');
  const ctx=`Mapa de ${C.name}: Sol ${SIGNS[C.sun.sign]}, Lua ${SIGNS[C.moon.sign]}, Asc ${SIGNS[C.asc.sign]}, Merc√∫rio ${SIGNS[C.mercury.sign]}, V√™nus ${SIGNS[C.venus.sign]}, Marte ${SIGNS[C.mars.sign]}, J√∫piter ${SIGNS[C.jupiter.sign]}, Saturno ${SIGNS[C.saturn.sign]}, Urano ${SIGNS[C.uranus.sign]}, Netuno ${SIGNS[C.neptune.sign]}, Plut√£o ${SIGNS[C.pluto.sign]}, Nodo Norte ${SIGNS[C.northNode.sign]}, Qu√≠ron ${SIGNS[C.chiron.sign]}.${C.stelliums.length>0?` Stellium: ${C.stelliums[0].planets.length} planetas em ${C.stelliums[0].house?'Casa '+C.stelliums[0].house:SIGNS[C.stelliums[0].sign]}.`:''}`;
  try{
    const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,system:`Voc√™ √© um astr√≥logo profundo, s√°bio e emp√°tico. Responda sempre em portugu√™s brasileiro, de forma pessoal e envolvente usando o nome da pessoa. Use sempre os dados reais do mapa abaixo. Nunca seja gen√©rico. 2-3 par√°grafos fluidos e po√©ticos.\n\n${ctx}`,messages:[{role:'user',content:msg}]})});
    const data=await r.json();
    el.innerHTML=`<span class="ai-label">‚ú¶ Astr√≥logo IA</span>${data.content?.[0]?.text||'N√£o consegui processar agora.'}`;
  }catch(e){el.innerHTML=`<span class="ai-label">‚ú¶ Astr√≥logo IA</span>${C.name}, com seu Sol em ${SIGNS[C.sun.sign]} e Lua em ${SIGNS[C.moon.sign]}, voc√™ carrega uma profundidade interior extraordin√°ria. Para respostas completas da IA, conecte sua chave Anthropic API no c√≥digo.`}
  document.getElementById('chat-msgs').scrollTop=99999;
}

function renderTransits(){
  const months=['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'],today=new Date();
  const dailyMsgs=[`${C.name}, hoje os astros ativam sua natureza de ${SIGNS[C.sun.sign]}. √â um dia para confiar em seus instintos.`,`Com a energia de hoje, ${C.name}, sua Lua em ${SIGNS[C.moon.sign]} pede aten√ß√£o. Ou√ßa seu cora√ß√£o antes de agir.`,`Os planetas de hoje tocam temas de ${HMEAN[(today.getDate()%12)].toLowerCase().split(',')[0]}, ${C.name}. Um momento de reflex√£o genu√≠na.`];
  const transits=[{i:'‚ôÉ',t:`J√∫piter expandindo sua Casa ${(today.getMonth()%12)+1}`,b:`Crescimento e abertura em ${HMEAN[(today.getMonth()%12)].toLowerCase().split(',')[0]}. Oportunidades surgem quando voc√™ se abre para receber.`},{i:'‚ôÑ',t:`Saturno estruturando sua Lua em ${SIGNS[C.moon.sign]}`,b:`Um convite para amadurecer emocionalmente. Lento, mas profundamente transformador.`},{i:'‚ôÇ',t:`Marte ativando seu Ascendente em ${SIGNS[C.asc.sign]}`,b:`Energia e visibilidade aumentadas. Hora de agir e ir atr√°s do que voc√™ deseja sem hesitar.`},{i:'‚òø',t:`Merc√∫rio afiando sua mente`,b:`Comunica√ß√µes importantes e insights surgem. Escreva, converse, negocie ‚Äî sua mente est√° afiada.`},{i:'‚ôÄ',t:`V√™nus iluminando seu cora√ß√£o`,b:`Um toque de gra√ßa nos relacionamentos e prazeres. Permita-se sentir e receber afeto.`}];
  document.getElementById('transit-out').innerHTML=`<div class="daily-hero"><div class="daily-date">‚ú¶ ${today.getDate()} de ${months[today.getMonth()]} de ${today.getFullYear()}</div><div class="daily-msg">${dailyMsgs[today.getDate()%3]}</div></div><div class="sec-label">Tr√¢nsitos Ativos</div>${transits.map(t=>`<div class="t-card"><div class="t-icon">${t.i}</div><div><div class="t-title">${t.t}</div><div class="t-body">${t.b}</div></div></div>`).join('')}<div class="sec-label">Previs√£o ‚Äî ${months[today.getMonth()]}</div><div class="step-card"><div class="step-body">${C.name}, ${months[today.getMonth()]} convida voc√™ a aprofundar temas de ${HMEAN[today.getMonth()%12].toLowerCase().split(',')[0]}. Com seu Sol em ${SIGNS[C.sun.sign]}, este m√™s pede autenticidade total. Saturno traz estrutura onde havia caos, enquanto J√∫piter abre portas. Confie no ritmo do universo ‚Äî ele sempre sabe o tempo certo.</div></div>`;
}

function showModal(i,p){const pl=PL[i],hN=Math.floor(n360(p.lon-C.asc.lon)/30)+1;document.getElementById('m-title').textContent=`${pl.s} ${pl.n} em ${SIGNS[p.sign]}`;document.getElementById('m-pos').textContent=`${p.deg}¬∞${p.min}' ${SIGNS[p.sign]} ¬∑ Casa ${hN}${C.retro[i]?' ¬∑ Retr√≥grado':''}`;document.getElementById('m-body').innerHTML=`<p>${PMEAN[pl.n]}</p><div class="divider"></div><p>Com <strong>${pl.n}</strong> em <strong>${SIGNS[p.sign]}</strong>, ${C.name} expressa as qualidades de ${SIGNS[p.sign]} atrav√©s de ${pl.n.toLowerCase()} ‚Äî colorindo essa energia com a intensidade √∫nica desse signo.</p>${C.retro[i]?`<div class="divider"></div><p style="color:#d4859a;font-style:italic">Retr√≥grado: esta energia √© mais internalizada e reflexiva. A express√£o vem de dentro para fora, ap√≥s muito amadurecimento interior.</p>`:''}`; document.getElementById('modal').classList.add('open')}
function closeModal(e){if(e.target===document.getElementById('modal'))document.getElementById('modal').classList.remove('open')}

function goTo(id){document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active')}
function navTo(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('pg-'+id).classList.add('active');
  el.classList.add('active');
  if(id==='mandala')setTimeout(renderMandala,50);
  if(id==='extras')renderExtras();
}
function savePNG(){const cv=document.getElementById('mc'),a=document.createElement('a');a.download=`mapa-${userData.name||'astral'}.png`;a.href=cv.toDataURL();a.click()}
function shareMap(){const txt=`‚ú¶ Meu Mapa Astral\n‚òâ Sol em ${SIGNS[C.sun.sign]}\n‚òΩ Lua em ${SIGNS[C.moon.sign]}\nAscendente em ${SIGNS[C.asc.sign]}\n\nDescoberto no StarsGuide ‚ú¶`;if(navigator.share)navigator.share({title:'Meu Mapa Astral',text:txt});else navigator.clipboard.writeText(txt).then(()=>alert('Copiado!'))}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 1. VOZ ‚Äî ASTR√ìLOGO NARRADOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let speaking=false,currentUtterance=null;
function speakChart(){
  if(speaking){window.speechSynthesis.cancel();speaking=false;document.getElementById('voice-btn').textContent='üîä Ouvir Meu Mapa';return}
  const text=`${C.name}, seu mapa astral revela uma alma extraordin√°ria. Com o Sol em ${SIGNS[C.sun.sign]}, voc√™ carrega em sua ess√™ncia toda a for√ßa e profundidade desse signo. Sua Lua em ${SIGNS[C.moon.sign]} ilumina seu mundo emocional com uma sensibilidade √∫nica e transformadora. Seu Ascendente em ${SIGNS[C.asc.sign]} √© a porta pela qual o mundo te encontra ‚Äî uma presen√ßa que marcam quem te conhece. Merc√∫rio em ${SIGNS[C.mercury.sign]} molda sua mente e sua comunica√ß√£o. V√™nus em ${SIGNS[C.venus.sign]} revela como voc√™ ama e o que seu cora√ß√£o deseja. Marte em ${SIGNS[C.mars.sign]} √© sua for√ßa de a√ß√£o ‚Äî como voc√™ conquista o que quer. ${C.stelliums.length>0?`Voc√™ possui um poderoso Stellium com ${C.stelliums[0].planets.length} planetas concentrados em ${C.stelliums[0].house?'sua Casa '+C.stelliums[0].house:SIGNS[C.stelliums[0].sign]}, tornando esses temas absolutamente centrais em sua jornada.`:''} Seu Nodo Norte em ${SIGNS[C.northNode.sign]} aponta para sua miss√£o de vida ‚Äî o caminho que sua alma escolheu trilhar nessa encarna√ß√£o. E seu Qu√≠ron em ${SIGNS[C.chiron.sign]} carrega a ferida ancestral que, quando curada, se torna seu maior dom. ${C.name}, voc√™ √© um ser de profundidade extraordin√°ria. O universo conspirou para que voc√™ nascesse exatamente como √© ‚Äî √∫nico, singular e necess√°rio.`;
  const u=new SpeechSynthesisUtterance(text);
  u.lang='pt-BR';u.rate=0.88;u.pitch=0.95;u.volume=1;
  const voices=window.speechSynthesis.getVoices();
  const ptVoice=voices.find(v=>v.lang.startsWith('pt'));
  if(ptVoice)u.voice=ptVoice;
  u.onend=()=>{speaking=false;document.getElementById('voice-btn').textContent='üîä Ouvir Meu Mapa'};
  window.speechSynthesis.speak(u);
  speaking=true;
  document.getElementById('voice-btn').textContent='‚èπ Parar Narra√ß√£o';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2. LUA EM TEMPO REAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getMoonPhase(){
  const now=new Date(),JD=jd(now.getFullYear(),now.getMonth()+1,now.getDate(),now.getHours()+now.getMinutes()/60);
  const moonAge=(JD-2451550.1)%29.53058853;
  const pct=(moonAge/29.53058853)*100;
  const phases=[
    {name:'Lua Nova',emoji:'üåë',range:[0,6.25],msg:'Momento de inten√ß√µes e novos come√ßos. Plante seus desejos no sil√™ncio.'},
    {name:'Lua Crescente',emoji:'üåí',range:[6.25,12.5],msg:'A energia cresce. Tome a√ß√£o em dire√ß√£o ao que voc√™ plantou.'},
    {name:'Quarto Crescente',emoji:'üåì',range:[12.5,18.75],msg:'Supere obst√°culos. √â hora de decis√µes e ajustes no caminho.'},
    {name:'Lua Gibosa Crescente',emoji:'üåî',range:[18.75,25],msg:'Refinamento e prepara√ß√£o. A manifesta√ß√£o est√° pr√≥xima.'},
    {name:'Lua Cheia',emoji:'üåï',range:[25,56.25],msg:'Plenitude e ilumina√ß√£o. O que foi plantado se revela. Celebre e libere.'},
    {name:'Lua Gibosa Minguante',emoji:'üåñ',range:[56.25,62.5],msg:'Gratid√£o e colheita. Receba o que o universo preparou para voc√™.'},
    {name:'Quarto Minguante',emoji:'üåó',range:[62.5,75],msg:'Revis√£o e perd√£o. Libere o que n√£o serve mais.'},
    {name:'Lua Minguante',emoji:'üåò',range:[75,100],msg:'Descanso e introspec√ß√£o. Prepare-se para um novo ciclo.'},
  ];
  const phase=phases.find(p=>pct>=p.range[0]&&pct<p.range[1])||phases[4];
  const moonSign=Math.floor(moonLon(JD)/30);
  return{phase,moonSign,pct:Math.round(pct),age:Math.round(moonAge)};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 3. PDF EXPORT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function exportPDF(){
  const cv=document.getElementById('mc');
  const mandalaData=cv.toDataURL('image/png');
  const win=window.open('','_blank');
  const c=C;
  win.document.write(`<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Mapa Astral ‚Äî ${c.name}</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300&family=Josefin+Sans:wght@100;300&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{background:#04010f;color:#ede6d6;font-family:'Cormorant Garamond',serif;padding:40px;min-height:100vh}
    .cover{text-align:center;padding:60px 0 40px;border-bottom:1px solid rgba(200,169,110,.2);margin-bottom:40px}
    h1{font-family:'Josefin Sans',sans-serif;font-weight:100;font-size:3rem;letter-spacing:.4em;color:#c8a96e;text-transform:uppercase;margin-bottom:8px}
    .sub{font-size:1rem;color:#6b5f4a;letter-spacing:.2em;font-style:italic;margin-bottom:30px}
    img{border-radius:50%;box-shadow:0 0 60px rgba(124,77,206,.4);width:280px;height:280px}
    .trio{display:flex;justify-content:center;gap:30px;margin:30px 0}
    .trio-item{text-align:center}
    .trio-item .lbl{font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.2em;color:#6b5f4a;text-transform:uppercase;margin-bottom:4px}
    .trio-item .val{font-size:1.3rem;color:#c8a96e}
    .section{margin-bottom:30px}
    .sec-title{font-family:'Josefin Sans',sans-serif;font-size:.65rem;letter-spacing:.25em;color:#6b5f4a;text-transform:uppercase;border-bottom:1px solid rgba(200,169,110,.1);padding-bottom:8px;margin-bottom:16px}
    .planet-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.95rem}
    .planet-name{color:#c8a96e}.planet-pos{color:#b8ad9e;font-style:italic}
    .interp{font-size:.95rem;line-height:1.9;color:#b8ad9e;background:rgba(255,255,255,.02);border:1px solid rgba(200,169,110,.08);border-radius:8px;padding:20px;margin-bottom:16px}
    .footer{text-align:center;margin-top:50px;padding-top:20px;border-top:1px solid rgba(200,169,110,.1);font-family:'Josefin Sans',sans-serif;font-size:.55rem;letter-spacing:.2em;color:#6b5f4a;text-transform:uppercase}
  
/* ‚îÄ‚îÄ iOS SAFE AREA ‚îÄ‚îÄ */
.top-bar{padding-top:max(16px,env(safe-area-inset-top))!important}
.nav-bar{padding-bottom:env(safe-area-inset-bottom,0)}
.modal-box{padding-bottom:max(38px,env(safe-area-inset-bottom))}

/* ‚îÄ‚îÄ PREVENT iOS INPUT ZOOM ‚îÄ‚îÄ */
input,select,textarea{font-size:16px!important}

/* ‚îÄ‚îÄ SMALL PHONES <= 360px ‚îÄ‚îÄ */
@media(max-width:360px){
  .app-name{letter-spacing:.2em!important;font-size:2rem!important}
  .nav-label{font-size:.42rem!important}
  .nav-item{padding:10px 2px 8px!important}
  .trio-sign{font-size:.78rem!important}
  .page{padding:14px 14px 36px!important}
  .btn-cosmic{padding:14px 28px!important;letter-spacing:.2em!important}
  .ob-scroll{padding:40px 18px!important}
}

/* ‚îÄ‚îÄ MEDIUM PHONES 361-480px ‚îÄ‚îÄ */
@media(min-width:361px) and (max-width:480px){
  .nav-label{font-size:.46rem!important}
}

/* ‚îÄ‚îÄ LARGE PHONES & SMALL TABLETS 481-768px ‚îÄ‚îÄ */
@media(min-width:481px){
  .page{padding:22px 24px 44px!important}
  .top-bar{padding-left:28px!important;padding-right:28px!important}
  .nav-item{padding:13px 6px 11px!important}
  .nav-label{font-size:.54rem!important;letter-spacing:.14em!important}
  .nav-icon{font-size:1.15rem!important}
  .ob-scroll{padding:60px 40px!important}
  .mandala-wrap{padding:10px 0 24px!important}
}

/* ‚îÄ‚îÄ TABLET 769-1024px ‚îÄ‚îÄ */
@media(min-width:769px){
  body{display:flex;justify-content:center;align-items:stretch}
  #app,#splash,#onboarding{max-width:768px;left:50%;transform:translateX(-50%)}
  .page{max-width:720px;margin:0 auto;padding:28px 32px 52px!important}
  .nav-item{padding:14px 8px 12px!important}
  .nav-label{font-size:.6rem!important;letter-spacing:.18em!important}
  .nav-icon{font-size:1.2rem!important}
  .top-bar{padding:16px 32px!important}
  .modal-box{max-width:600px;border-radius:20px!important;margin-bottom:10vh}
  .modal-bg{align-items:center!important}
  .chat-wrap{height:calc(100svh - 140px)!important}
  .field-row{gap:24px!important}
  .score-n{font-size:5.5rem!important}
  .trio-cards{gap:16px!important}
  .trio-card{padding:18px 12px!important}
  .trio-sym{font-size:2rem!important}
  .step-title{font-size:1.3rem!important}
  .step-body{font-size:1rem!important}
  .h-desc,.p-desc,.t-body{font-size:.92rem!important}
}

/* ‚îÄ‚îÄ DESKTOP 1025px+ ‚îÄ‚îÄ */
@media(min-width:1025px){
  #app,#splash,#onboarding{max-width:900px}
  .page{max-width:860px!important;padding:32px 40px 60px!important}
  .top-logo{font-size:1rem!important;letter-spacing:.4em!important}
  .modal-box{max-width:660px!important}
  .chat-wrap{height:calc(100vh - 130px)!important}
  .p-card:hover{background:rgba(200,169,110,.05)!important;border-color:rgba(200,169,110,.3)!important;transform:translateX(4px)!important}
  .trio-card:hover{background:rgba(200,169,110,.06)!important;transform:scale(.98)!important}
  .chip:hover{background:rgba(200,169,110,.1)!important;border-color:var(--gold)!important;color:var(--gold)!important}
  .btn-cosmic:hover{background:rgba(200,169,110,.12)!important;border-color:rgba(200,169,110,.7)!important}
}

/* ‚îÄ‚îÄ LANDSCAPE MOBILE ‚îÄ‚îÄ */
@media(max-height:480px) and (orientation:landscape){
  .splash-sigil{width:70px!important;height:70px!important;margin-bottom:12px!important}
  .app-tagline{margin-bottom:20px!important}
  .ob-scroll{padding-top:20px!important;padding-bottom:20px!important;justify-content:flex-start!important}
  #mc{max-width:50vw!important;max-height:50vw!important;width:50vw!important;height:50vw!important}
  .nav-item{padding:8px 2px 6px!important}
  .nav-label{font-size:.4rem!important}
}

/* ‚îÄ‚îÄ HIGH DPI / RETINA ‚îÄ‚îÄ */
@media(-webkit-min-device-pixel-ratio:2),(min-resolution:192dpi){
  .btn-cosmic{border-width:.5px!important}
}

/* ‚îÄ‚îÄ DARK MODE (always) ‚îÄ‚îÄ */
@media(prefers-color-scheme:light){
  html{background:#04010f!important}
}

/* ‚îÄ‚îÄ MANDALA RESPONSIVE ‚îÄ‚îÄ */
#mc{max-width:min(340px, calc(100vw - 36px))!important}

</style></head><body>
  <div class="cover">
    <h1>StarsGuide</h1>
    <div class="sub">Mapa Astral de ${c.name}</div>
    <img src="${mandalaData}" alt="Mandala"/>
    <div class="trio">
      <div class="trio-item"><div class="lbl">Sol</div><div class="val">‚òâ ${SIGNS[c.sun.sign]}</div></div>
      <div class="trio-item"><div class="lbl">Lua</div><div class="val">‚òΩ ${SIGNS[c.moon.sign]}</div></div>
      <div class="trio-item"><div class="lbl">Ascendente</div><div class="val">‚Üë ${SIGNS[c.asc.sign]}</div></div>
    </div>
  </div>
  <div class="section">
    <div class="sec-title">Posi√ß√£o dos Planetas</div>
    ${c.planets.map((p,i)=>{if(i>=PL.length)return'';return`<div class="planet-row"><span class="planet-name">${PL[i].s} ${PL[i].n}${c.retro[i]?' ‚Ñû':''}</span><span class="planet-pos">${p.deg}¬∞${p.min}' ${SIGNS[p.sign]} ¬∑ Casa ${Math.floor(n360(p.lon-c.asc.lon)/30)+1}</span></div>`}).join('')}
  </div>
  <div class="section">
    <div class="sec-title">Interpreta√ß√£o Completa</div>
    ${c.planets.slice(0,6).map((p,i)=>`<div class="interp"><strong style="color:#c8a96e">${PL[i].s} ${PL[i].n} em ${SIGNS[p.sign]}</strong><br><br>${PMEAN[PL[i].n]}</div>`).join('')}
  </div>
  ${c.stelliums.length>0?`<div class="section"><div class="sec-title">Stellium</div><div class="interp"><strong style="color:#c8a96e">‚ú¶ ${c.stelliums[0].house?'Casa '+c.stelliums[0].house:SIGNS[c.stelliums[0].sign]}</strong><br><br>${c.name} possui ${c.stelliums[0].planets.length} planetas concentrados em ${c.stelliums[0].house?'Casa '+c.stelliums[0].house:SIGNS[c.stelliums[0].sign]}: ${c.stelliums[0].planets.map(i=>PL[i]?.n).filter(Boolean).join(', ')}. Esta concentra√ß√£o define o tema central desta encarna√ß√£o.</div></div>`:''}
  <div class="footer">‚ú¶ StarsGuide ¬∑ O cosmos dentro de voc√™ ¬∑ Gerado em ${new Date().toLocaleDateString('pt-BR')}</div>
  <script>window.onload=()=>{setTimeout(()=>window.print(),800)}<\/script>
  </body></html>`);
  win.document.close();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 4. CARTA DE AMOR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function generateLoveLetter(){
  if(!syn||!syn.name){alert('Fa√ßa a Sinastria primeiro para gerar a Carta de Amor.');return}
  const el=document.getElementById('love-letter-content');
  el.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
  const c1=C,c2=syn;
  const prompt=`Escreva uma carta de amor po√©tica e profunda de ${c1.name} para ${c2.name}, baseada nos dados astrol√≥gicos a seguir. A carta deve ser √≠ntima, po√©tica, emocionante e √∫nica. Escreva em primeira pessoa como se fosse ${c1.name} escrevendo. Use refer√™ncias astrol√≥gicas sutis sem ser t√©cnico demais. M√°ximo 4 par√°grafos.\n\nMapa de ${c1.name}: Sol ${SIGNS[c1.sun.sign]}, Lua ${SIGNS[c1.moon.sign]}, V√™nus ${SIGNS[c1.venus.sign]}.\nMapa de ${c2.name}: Sol ${SIGNS[c2.sun.sign]}, Lua ${SIGNS[c2.moon.sign]}, V√™nus ${SIGNS[c2.venus.sign]}.`;
  try{
    const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,system:'Voc√™ √© um poeta astr√≥logo. Escreva cartas de amor profundas, po√©ticas e personalizadas em portugu√™s brasileiro.',messages:[{role:'user',content:prompt}]})});
    const data=await r.json();
    const letter=data.content?.[0]?.text||'';
    el.innerHTML=`<p style="font-style:italic;line-height:2;font-size:1rem">${letter.replace(/\n\n/g,'</p><p style="margin-top:16px;font-style:italic;line-height:2;font-size:1rem">')}</p>`;
  }catch(e){
    el.innerHTML=`<p style="font-style:italic;line-height:2">${c1.name},<br><br>Voc√™ √© Sol em ${SIGNS[c1.sun.sign]} e eu, ${c2.name}, sou Sol em ${SIGNS[c2.sun.sign]} ‚Äî e foi exatamente nessa diferen√ßa que encontrei o que sempre busquei. Sua Lua em ${SIGNS[c1.moon.sign]} encontra minha Lua em ${SIGNS[c2.moon.sign]} num sil√™ncio que n√£o precisa de palavras. Voc√™ me v√™ onde ningu√©m mais olha. E √© nesse olhar que eu me reconhe√ßo inteira.<br><br>Com amor do universo,<br>${c2.name}</p>`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 5. TIMER LUNAR
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startLunarTimer(){
  const moon=getMoonPhase();
  const nextPhaseMs=((29.53058853-(moon.age))*24*60*60*1000);
  let remaining=Math.floor(nextPhaseMs/1000);
  const el=document.getElementById('lunar-timer');
  const interval=setInterval(()=>{
    remaining--;
    if(remaining<=0){clearInterval(interval);el.textContent='Nova fase lunar chegou!';return}
    const d=Math.floor(remaining/86400),h=Math.floor((remaining%86400)/3600),m=Math.floor((remaining%3600)/60),s=remaining%60;
    el.textContent=`${d}d ${h}h ${m}m ${s}s`;
  },1000);
  const d2=Math.floor(remaining/86400),h2=Math.floor((remaining%86400)/3600),m2=Math.floor((remaining%3600)/60),s2=remaining%60;
  el.textContent=`${d2}d ${h2}h ${m2}m ${s2}s`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 6. LINHA DO TEMPO K√ÅRMICA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getKarmicTimeline(){
  const c=C;
  const nodeSign=c.northNode.sign;
  const southSign=(nodeSign+6)%12;
  const pastLives=[
    {era:'Vida Passada Dominante',sign:SIGNS[southSign],desc:`Em vidas anteriores, voc√™ dominou os temas de ${SIGNS[southSign]} com maestria. Trouxe consigo habilidades, padr√µes e confortos dessa energia ‚Äî mas tamb√©m seus excessos e limita√ß√µes.`},
    {era:'Transi√ß√£o K√°rmica',sign:SIGNS[c.saturn.sign],desc:`Saturno em ${SIGNS[c.saturn.sign]} marca as li√ß√µes que voc√™ carrega de outras encarna√ß√µes. S√£o as √°reas onde a vida parece mais exigente ‚Äî mas √© exatamente onde seu maior crescimento acontece.`},
    {era:'Miss√£o Atual',sign:SIGNS[nodeSign],desc:`Seu Nodo Norte em ${SIGNS[nodeSign]} √© o destino da sua alma nessa vida. Cada vez que voc√™ se move em dire√ß√£o a ${SIGNS[nodeSign]}, sente um expans√£o profunda ‚Äî mesmo que assustadora. √â o caminho que seu esp√≠rito escolheu.`},
    {era:'Dom de Qu√≠ron',sign:SIGNS[c.chiron.sign],desc:`Qu√≠ron em ${SIGNS[c.chiron.sign]} representa a ferida que atravessa encarna√ß√µes. Quando voc√™ para de lutar contra ela e come√ßa a trabalhar com ela, ela se transforma no seu maior superpoder de cura.`},
    {era:'Pr√≥xima Fronteira',sign:SIGNS[(nodeSign+1)%12],desc:`Al√©m da sua miss√£o atual, os temas de ${SIGNS[(nodeSign+1)%12]} aguardam ‚Äî a expans√£o que vir√° quando a miss√£o atual for integrada. O universo sempre tem um pr√≥ximo cap√≠tulo preparado.`},
  ];
  return pastLives;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 7. FISIOGNOMIA (AN√ÅLISE DE ROSTO)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function analyzePhoto(){
  const file=document.getElementById('photo-input').files[0];
  if(!file){alert('Selecione uma foto primeiro.');return}
  const reader=new FileReader();
  reader.onload=async(e)=>{
    const base64=e.target.result.split(',')[1];
    const el=document.getElementById('physio-result');
    el.innerHTML='<div class="dots"><span></span><span></span><span></span></div>';
    try{
      const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,system:`Voc√™ √© um astr√≥logo especialista em fisiognomia ‚Äî a arte de ler tra√ßos do rosto √† luz da astrologia. A pessoa tem Ascendente em ${SIGNS[C.asc.sign]}, Sol em ${SIGNS[C.sun.sign]} e Lua em ${SIGNS[C.moon.sign]}. Analise a imagem e relacione os tra√ßos faciais com esses posicionamentos astrol√≥gicos. Seja po√©tico, preciso e revelador. Escreva em portugu√™s brasileiro. 3 par√°grafos.`,messages:[{role:'user',content:[{type:'image',source:{type:'base64',media_type:file.type,data:base64}},{type:'text',text:`Analise os tra√ßos fision√¥micos desta pessoa com Ascendente em ${SIGNS[C.asc.sign]}, Sol em ${SIGNS[C.sun.sign]} e Lua em ${SIGNS[C.moon.sign]}.`}]}]})});
      const data=await r.json();
      el.innerHTML=`<div class="step-body" style="margin-top:0">${data.content?.[0]?.text||'N√£o foi poss√≠vel analisar.'}</div>`;
    }catch(e){el.innerHTML=`<div class="step-body" style="margin-top:0">${C.name}, seu Ascendente em ${SIGNS[C.asc.sign]} imprime tra√ßos marcantes na sua apar√™ncia ‚Äî uma presen√ßa que combina a intensidade de ${SIGNS[C.sun.sign]} com a sensibilidade emocional de ${SIGNS[C.moon.sign]}. Sua express√£o carrega a sabedoria de quem sente profundamente antes de falar. (Conecte a API para an√°lise visual completa.)</div>`}
  };
  reader.readAsDataURL(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RENDER EXTRAS PAGE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderExtras(){
  const moon=getMoonPhase();
  const karmic=getKarmicTimeline();
  const months=['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
  const today=new Date();

  document.getElementById('extras-out').innerHTML=`

    <!-- VOICE -->
    <div class="sec-label" style="margin-top:0">Narra√ß√£o do Mapa</div>
    <div class="step-card" style="text-align:center">
      <div style="font-size:3rem;margin-bottom:12px">üîä</div>
      <div class="step-title">Ou√ßa seu Mapa Astral</div>
      <div class="step-body" style="margin-bottom:16px">O astr√≥logo narra seu mapa completo em voz real, como uma sess√£o de astrologia personalizada.</div>
      <button class="btn-cosmic" id="voice-btn" style="width:100%;text-align:center;display:block" onclick="speakChart()">üîä Ouvir Meu Mapa</button>
    </div>

    <!-- LUA TEMPO REAL -->
    <div class="sec-label">Lua em Tempo Real</div>
    <div class="step-card">
      <div style="display:flex;align-items:center;gap:16px;margin-bottom:14px">
        <div style="font-size:3.5rem;filter:drop-shadow(0 0 15px rgba(200,169,110,.5))">${moon.phase.emoji}</div>
        <div>
          <div style="font-family:'Josefin Sans',sans-serif;font-size:.7rem;letter-spacing:.15em;color:var(--gold);text-transform:uppercase;margin-bottom:4px">${moon.phase.name}</div>
          <div style="font-size:.85rem;color:var(--dim);font-style:italic">Lua em ${SIGNS[moon.moonSign]} ¬∑ ${moon.age} dias de ciclo</div>
        </div>
      </div>
      <div class="step-body" style="margin-bottom:14px">${moon.phase.msg}</div>
      <div style="background:rgba(255,255,255,.03);border:1px solid rgba(200,169,110,.1);border-radius:10px;padding:14px;text-align:center">
        <div style="font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.15em;color:var(--dim);text-transform:uppercase;margin-bottom:6px">Pr√≥xima Fase em</div>
        <div id="lunar-timer" style="font-family:'Josefin Sans',sans-serif;font-size:1.4rem;color:var(--gold);letter-spacing:.1em">Calculando...</div>
      </div>
      <div style="margin-top:14px" class="step-body">
        <strong>Para voc√™, ${C.name}</strong> ‚Äî com Lua natal em ${SIGNS[C.moon.sign]}, esta fase ${moon.phase.name} ativa especialmente os temas de ${SIGNS[moon.moonSign]}${moon.moonSign===C.moon.sign?' ‚Äî sua Lua natal! Um momento de intensidade emocional extraordin√°ria.':' em rela√ß√£o √† sua Lua natal. Observe como suas emo√ß√µes respondem a esse ciclo.'}</div>
    </div>

    <!-- PDF -->
    <div class="sec-label">Relat√≥rio Completo</div>
    <div class="step-card" style="text-align:center">
      <div style="font-size:3rem;margin-bottom:12px">üìÑ</div>
      <div class="step-title">Exportar Mapa em PDF</div>
      <div class="step-body" style="margin-bottom:16px">Gera um relat√≥rio completo com a mandala e toda a interpreta√ß√£o do seu mapa para salvar ou imprimir.</div>
      <button class="btn-cosmic" style="width:100%;text-align:center;display:block" onclick="exportPDF()">‚ú¶ Gerar PDF</button>
    </div>

    <!-- CARTA DE AMOR -->
    <div class="sec-label">Carta de Amor Astral</div>
    <div class="step-card">
      <div style="font-size:2rem;margin-bottom:10px;text-align:center">üíå</div>
      <div class="step-title">Carta Gerada pelos Astros</div>
      <div class="step-body" style="margin-bottom:16px">Baseada na Sinastria, a IA cria uma carta de amor √∫nica e po√©tica ${syn&&syn.name?`de ${C.name} para ${syn.name}`:'‚Äî fa√ßa a Sinastria primeiro'}.</div>
      <button class="btn-cosmic" style="width:100%;text-align:center;display:block;margin-bottom:16px" onclick="generateLoveLetter()">üíå Gerar Carta de Amor</button>
      <div id="love-letter-content" style="font-size:.95rem;line-height:1.9;color:var(--soft)"></div>
      <div id="love-share" style="margin-top:14px;display:none">
        <button class="btn-cosmic" style="width:100%;text-align:center;display:block;font-size:.7rem" onclick="shareLetter()">üì§ Compartilhar Carta</button>
      </div>
    </div>

    <!-- TIMER LUNAR -->
    <div class="sec-label">Timer Lunar Pessoal</div>
    <div class="step-card">
      <div style="font-size:2rem;margin-bottom:10px;text-align:center">‚è≥</div>
      <div class="step-title">Rituais no Tempo Certo</div>
      <div class="step-body" style="margin-bottom:14px">O que fazer agora, baseado na fase lunar e no seu mapa:</div>
      ${[
        {phase:'üåë Lua Nova',action:`Escreva suas inten√ß√µes para ${SIGNS[C.northNode.sign]} ‚Äî sua miss√£o de vida. Medite em sil√™ncio.`},
        {phase:'üåï Lua Cheia',action:`Libere o que n√£o serve mais em ${SIGNS[C.saturn.sign]}. Ore, dance, celebre sob a luz da lua.`},
        {phase:'üåì Quarto Crescente',action:`Tome uma decis√£o relacionada a ${SIGNS[C.mars.sign]}. Aja com coragem.`},
        {phase:'üåó Quarto Minguante',action:`Perdoe algo relacionado a ${SIGNS[C.chiron.sign]}. Solte a ferida com gratid√£o.`},
      ].map(r=>`<div style="background:rgba(255,255,255,.02);border:1px solid rgba(200,169,110,.08);border-radius:10px;padding:12px;margin-bottom:8px"><div style="font-size:.85rem;color:var(--gold);margin-bottom:4px">${r.phase}</div><div style="font-size:.85rem;color:var(--soft);line-height:1.6">${r.action}</div></div>`).join('')}
    </div>

    <!-- LINHA DO TEMPO K√ÅRMICA -->
    <div class="sec-label">Linha do Tempo K√°rmica</div>
    ${karmic.map((k,i)=>`
      <div style="display:flex;gap:14px;margin-bottom:0;position:relative">
        <div style="display:flex;flex-direction:column;align-items:center;gap:0;flex-shrink:0">
          <div style="width:36px;height:36px;border-radius:50%;background:rgba(200,169,110,.1);border:1px solid rgba(200,169,110,.3);display:flex;align-items:center;justify-content:center;font-size:.75rem;color:var(--gold);font-family:'Josefin Sans',sans-serif">${i+1}</div>
          ${i<karmic.length-1?`<div style="width:1px;height:30px;background:rgba(200,169,110,.15);margin:4px 0"></div>`:''}
        </div>
        <div style="flex:1;padding-bottom:${i<karmic.length-1?'8':'0'}px">
          <div style="font-family:'Josefin Sans',sans-serif;font-size:.6rem;letter-spacing:.15em;color:var(--gold);text-transform:uppercase;margin-bottom:3px">${k.era}</div>
          <div style="font-size:.8rem;color:var(--accent);margin-bottom:6px;font-style:italic">${k.sign}</div>
          <div style="font-size:.85rem;line-height:1.7;color:var(--soft);background:rgba(255,255,255,.02);border:1px solid rgba(200,169,110,.08);border-radius:10px;padding:12px;margin-bottom:8px">${k.desc}</div>
        </div>
      </div>
    `).join('')}

    <!-- FISIOGNOMIA -->
    <div class="sec-label">Leitura Fision√¥mica</div>
    <div class="step-card">
      <div style="font-size:2rem;margin-bottom:10px;text-align:center">üëÅ</div>
      <div class="step-title">Seu Rosto Revela seu Mapa</div>
      <div class="step-body" style="margin-bottom:16px">Envie uma foto do seu rosto e a IA analisar√° seus tra√ßos √† luz do seu Ascendente em ${SIGNS[C.asc.sign]}, Sol em ${SIGNS[C.sun.sign]} e Lua em ${SIGNS[C.moon.sign]}.</div>
      <label style="display:block;width:100%;padding:14px;border:1px dashed rgba(200,169,110,.3);border-radius:8px;text-align:center;cursor:pointer;font-family:'Josefin Sans',sans-serif;font-size:.7rem;letter-spacing:.15em;color:var(--dim);text-transform:uppercase;margin-bottom:12px">
        üì∑ Escolher Foto
        <input type="file" id="photo-input" accept="image/*" style="display:none" onchange="analyzePhoto()"/>
      </label>
      <div id="physio-result"></div>
    </div>

  `;

  // Start lunar timer after render
  setTimeout(startLunarTimer,100);
}

function shareLetter(){
  const el=document.getElementById('love-letter-content');
  const txt=el.innerText;
  if(navigator.share)navigator.share({title:'Carta de Amor Astral',text:txt});
  else navigator.clipboard.writeText(txt).then(()=>alert('Carta copiada!'));
}
</script>
</body>
</html>
